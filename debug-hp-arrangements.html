<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HP Arrangements Debug Test</title>
    <link rel="stylesheet" href="reservation.css">
    <style>
        body {
            padding: 20px;
            background: #f5f5f5;
        }

        .debug-container {
            background: #2d8f4f;
            padding: 20px;
            margin: 20px 0;
        }

        .debug-log {
            background: #000;
            color: #0f0;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
        }
    </style>
</head>

<body>
    <h1>HP Arrangements Debug - ResID 7144</h1>

    <div class="debug-container">
        <div class="header-content">
            <div class="header-info">
                <strong>Debug Reservierung 7144</strong> - Hindenburg
            </div>

            <div class="header-arrangements" id="headerArrangements">
                <div class="header-arr-title">HP Arrangements</div>
                <div class="header-arr-content" id="headerArrContent">
                    <div class="loading-arr">Arrangements laden...</div>
                </div>
                <button class="header-arr-edit-btn">✏️</button>
            </div>

            <div class="header-buttons">
                <button class="header-btn">Debug</button>
            </div>
        </div>
    </div>

    <div class="debug-log" id="debugLog">Starting debug...\n</div>

    <script>
        function debugLog(message) {
            const log = document.getElementById('debugLog');
            log.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '\n';
        }

        async function testHpArrangements() {
            debugLog('Testing HP Arrangements API...');

            const headerArrContent = document.getElementById('headerArrContent');
            if (!headerArrContent) {
                debugLog('ERROR: headerArrContent not found');
                return;
            }

            debugLog('headerArrContent found, making API call...');

            try {
                const response = await fetch('get-hp-arrangements-header.php?res_id=7144');
                debugLog('API response status: ' + response.status);

                const data = await response.json();
                debugLog('API response data: ' + JSON.stringify(data, null, 2));

                if (data.success && data.arrangements && data.arrangements.length > 0) {
                    debugLog('Found ' + data.arrangements.length + ' arrangements');

                    let html = '';
                    data.arrangements.forEach(arr => {
                        const guestCount = Object.keys(arr.guests || {}).length;
                        const countDisplay = guestCount > 1 ? `${arr.total_count}x (${guestCount} Gäste)` : `${arr.total_count}x`;
                        const timeClass = arr.time_class || 'time-old';

                        html += `
                            <div class="header-arr-item ${timeClass}">
                                <span class="arr-display-name">${arr.display_name}</span>: 
                                <span class="arr-count ${timeClass}">${countDisplay}</span>
                            </div>
                        `;

                        debugLog('Added arrangement: ' + arr.display_name + ' (' + timeClass + ')');
                    });

                    debugLog('Setting HTML: ' + html);
                    headerArrContent.innerHTML = html;
                    debugLog('HTML set successfully');

                } else {
                    debugLog('No arrangements found or API failed');
                    headerArrContent.innerHTML = '<div class="empty-arr">Keine Arrangements</div>';
                }

            } catch (error) {
                debugLog('ERROR: ' + error.message);
                headerArrContent.innerHTML = '<div class="empty-arr">Fehler: ' + error.message + '</div>';
            }
        }

        // Test starten
        setTimeout(testHpArrangements, 1000);
    </script>
</body>

</html>