<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Holiday Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }

        .success {
            background: #d4edda;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
        }

        button {
            margin: 5px;
            padding: 10px 15px;
        }
    </style>
</head>

<body>
    <h1>🎉 Holiday Integration Debug Test</h1>

    <div id="status" class="status info">Initialisiere...</div>

    <button onclick="testHolidayManager()">Test Holiday Manager</button>
    <button onclick="testTimelineIntegration()">Test Timeline Integration</button>
    <button onclick="checkToday()">Check Today</button>

    <div id="results"></div>

    <script src="holiday-manager.js"></script>
    <script src="timeline-unified-f2.js"></script>

    <script>
        const log = (msg, type = 'info') => {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = new Date().toLocaleTimeString() + ': ' + msg;
            document.getElementById('results').appendChild(div);
            console.log(msg);
        };

        function updateStatus(msg, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = msg;
            status.className = `status ${type}`;
        }

        async function testHolidayManager() {
            try {
                log('Testing Holiday Manager...');

                if (!window.holidayManager) {
                    log('❌ Holiday Manager nicht gefunden!', 'error');
                    return;
                }

                log('✅ Holiday Manager verfügbar', 'success');

                // Test API Call
                const holidays = await window.holidayManager.loadPublicHolidays('DE', 2025);
                log(`Gefunden: ${holidays.length} deutsche Feiertage für 2025`, 'success');

                if (holidays.length > 0) {
                    log(`Erster Feiertag: ${holidays[0].date} - ${holidays[0].localName}`, 'info');
                }

                // Test Badge Creation
                const testDate = new Date('2025-12-25');
                const testHolidaysMap = new Map();
                testHolidaysMap.set('2025-12-25', [
                    { country: 'DE', localName: 'Weihnachten', name: 'Christmas Day', global: true }
                ]);

                const holidayInfo = window.holidayManager.getHolidayInfo(testDate, testHolidaysMap);
                const badge = window.holidayManager.createHolidayBadge(holidayInfo);

                if (badge) {
                    log(`✅ Badge erstellt: ${badge}`, 'success');
                    const testDiv = document.createElement('div');
                    testDiv.innerHTML = `Weihnachten 2025: ${badge}`;
                    testDiv.style.margin = '10px 0';
                    document.getElementById('results').appendChild(testDiv);
                } else {
                    log('❌ Badge konnte nicht erstellt werden', 'error');
                }

            } catch (error) {
                log(`❌ Fehler: ${error.message}`, 'error');
            }
        }

        async function testTimelineIntegration() {
            try {
                log('Testing Timeline Integration...');

                if (typeof TimelineUnifiedRenderer === 'undefined') {
                    log('❌ TimelineUnifiedRenderer nicht verfügbar', 'error');
                    return;
                }

                log('✅ TimelineUnifiedRenderer verfügbar', 'success');

                if (window.timelineRenderer) {
                    log('✅ Timeline-Instanz gefunden', 'success');

                    if (typeof window.timelineRenderer.loadHolidaysForCurrentRange === 'function') {
                        log('✅ Holiday-Methoden verfügbar', 'success');
                        await window.timelineRenderer.loadHolidaysForCurrentRange();
                        log('✅ Feiertage für Timeline geladen', 'success');
                    } else {
                        log('❌ Holiday-Methoden nicht verfügbar', 'error');
                    }
                } else {
                    log('❌ Keine Timeline-Instanz gefunden', 'error');
                }

            } catch (error) {
                log(`❌ Fehler: ${error.message}`, 'error');
            }
        }

        async function checkToday() {
            try {
                log('Checking today for holidays...');

                const today = new Date();
                const todayStr = today.toLocaleDateString('de-DE');

                if (!window.holidayManager) {
                    log('❌ Holiday Manager nicht verfügbar', 'error');
                    return;
                }

                const startOfYear = new Date(today.getFullYear(), 0, 1);
                const endOfYear = new Date(today.getFullYear(), 11, 31);

                const holidaysMap = await window.holidayManager.loadHolidaysForDateRange(startOfYear, endOfYear);
                const todayHolidays = window.holidayManager.getHolidayInfo(today, holidaysMap);

                if (todayHolidays.length > 0) {
                    log(`🎉 Heute (${todayStr}) ist Feiertag:`, 'success');
                    todayHolidays.forEach(h => {
                        log(`  ${h.country}: ${h.localName}`, 'info');
                    });
                } else {
                    log(`📅 Heute (${todayStr}) ist kein Feiertag`, 'info');
                }

            } catch (error) {
                log(`❌ Fehler: ${error.message}`, 'error');
            }
        }

        // Auto-start when loaded
        setTimeout(() => {
            updateStatus('Bereit für Tests', 'success');
            log('Debug Test Ready - Click buttons to test functionality');
        }, 1000);
    </script>
</body>

</html>