<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timeline Unified - Syntax Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }

        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #0056b3;
        }
    </style>
</head>

<body>
    <div class="test-container">
        <h1>Timeline Unified - Syntax Validation Test</h1>
        <p>Test für die behobenen Syntax-Fehler in timeline-unified.html</p>

        <div id="test-status" class="status info">Bereit für Tests...</div>

        <button onclick="testVariableDeclarations()">Test Variable Declarations</button>
        <button onclick="testFunctionAvailability()">Test Function Availability</button>
        <button onclick="testAPICompatibility()">Test API Compatibility</button>
        <button onclick="loadDemoData()">Load Demo Data</button>

        <div id="test-results"></div>
    </div>

    <!-- Scripts - Same structure as timeline-unified.html but with validation -->
    <script src="timeline-unified.js"></script>
    <script>
        // ===== SYNTAX VALIDATION TESTS =====

        function updateTestStatus(message, type = 'info') {
            const statusEl = document.getElementById('test-status');
            statusEl.className = `status ${type}`;
            statusEl.innerHTML = message;
        }

        function addTestResult(test, result, details = '') {
            const resultsEl = document.getElementById('test-results');
            const resultEl = document.createElement('div');
            resultEl.className = `status ${result ? 'success' : 'error'}`;
            resultEl.innerHTML = `
                <strong>${test}:</strong> ${result ? '✅ PASS' : '❌ FAIL'}
                ${details ? `<br><small>${details}</small>` : ''}
            `;
            resultsEl.appendChild(resultEl);
        }

        // ===== FUNCTION DEFINITIONS (moved to top for onclick availability) =====

        // Test Variable Declarations
        function testVariableDeclarations() {
            updateTestStatus('Testing variable declarations...', 'info');

            try {
                // Test dass keine Redeclaration-Fehler auftreten
                const hasReservations = typeof reservations !== 'undefined';
                const hasRoomDetails = typeof roomDetails !== 'undefined';
                const hasRooms = typeof rooms !== 'undefined';
                const hasTimelineRenderer = typeof timelineRenderer !== 'undefined';

                addTestResult('reservations variable', hasReservations, `Type: ${typeof reservations}`);
                addTestResult('roomDetails variable', hasRoomDetails, `Type: ${typeof roomDetails}`);
                addTestResult('rooms variable', hasRooms, `Type: ${typeof rooms}`);
                addTestResult('timelineRenderer variable', hasTimelineRenderer, `Type: ${typeof timelineRenderer}`);

                // Test dass keine Redeclaration Error aufgetreten ist
                addTestResult('No redeclaration errors', true, 'Variables properly declared without conflicts');

                updateTestStatus('Variable declaration tests completed', 'success');

            } catch (error) {
                addTestResult('Variable declarations', false, `Error: ${error.message}`);
                updateTestStatus('Variable declaration test failed', 'error');
            }
        }

        // Test Function Availability  
        function testFunctionAvailability() {
            updateTestStatus('Testing function availability...', 'info');

            const functions = [
                'loadRealData',
                'generateDemoData',
                'changeZoom',
                'toggleDisposedReservations',
                'renderTimeline',
                'resetDates',
                'parseAPIDate'
            ];

            functions.forEach(funcName => {
                const isAvailable = typeof window[funcName] === 'function' || typeof eval(funcName) === 'function';
                addTestResult(`Function ${funcName}`, isAvailable, isAvailable ? 'Available for onclick' : 'Not found');
            });

            updateTestStatus('Function availability tests completed', 'success');
        }

        // Test API Compatibility
        function testAPICompatibility() {
            updateTestStatus('Testing API compatibility...', 'info');

            try {
                // Test parseAPIDate function
                const testDate1 = parseAPIDate('2025-01-15');
                const testDate2 = parseAPIDate('15.01.2025');
                const testDate3 = parseAPIDate('2025-01-15 14:30:00');

                addTestResult('parseAPIDate ISO format', testDate1 instanceof Date && !isNaN(testDate1));
                addTestResult('parseAPIDate German format', testDate2 instanceof Date && !isNaN(testDate2));
                addTestResult('parseAPIDate ISO datetime', testDate3 instanceof Date && !isNaN(testDate3));

                updateTestStatus('API compatibility tests completed', 'success');

            } catch (error) {
                addTestResult('API compatibility', false, `Error: ${error.message}`);
                updateTestStatus('API compatibility test failed', 'error');
            }
        }

        // Load Demo Data Test
        function loadDemoData() {
            updateTestStatus('Loading demo data...', 'info');

            try {
                generateDemoData();

                addTestResult('Demo data generation', true, `Generated ${reservations.length} reservations, ${rooms.length} rooms`);
                addTestResult('Timeline renderer creation', timelineRenderer !== null, 'Renderer initialized');

                updateTestStatus('Demo data loaded successfully', 'success');

            } catch (error) {
                addTestResult('Demo data loading', false, `Error: ${error.message}`);
                updateTestStatus('Demo data loading failed', 'error');
            }
        }

        // API-Datum-Parser (kompatibel mit getZimmerplanData.php)
        function parseAPIDate(dateString) {
            if (!dateString) return new Date();

            dateString = dateString.trim();

            // ISO-Format (YYYY-MM-DD oder YYYY-MM-DD HH:MM:SS)
            if (/^\d{4}-\d{2}-\d{2}/.test(dateString)) {
                return new Date(dateString);
            }

            // Deutsches Format (DD.MM.YYYY)
            if (/^\d{1,2}\.\d{1,2}\.\d{4}/.test(dateString)) {
                const parts = dateString.split('.');
                if (parts.length >= 3) {
                    const day = parseInt(parts[0], 10);
                    const month = parseInt(parts[1], 10) - 1;
                    const year = parseInt(parts[2], 10);
                    return new Date(year, month, day, 12, 0, 0, 0);
                }
            }

            return new Date(dateString);
        }

        // Demo-Daten Generator
        function generateDemoData() {
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - 7);

            const endDate = new Date();
            endDate.setDate(endDate.getDate() + 30);

            // Demo Zimmer
            rooms = [
                { id: 1, caption: 'Zimmer 1', capacity: 2, display_name: 'Zimmer 1 (2P)' },
                { id: 2, caption: 'Zimmer 2', capacity: 4, display_name: 'Zimmer 2 (4P)' },
                { id: 3, caption: 'Zimmer 3', capacity: 6, display_name: 'Zimmer 3 (6P)' }
            ];

            // Demo Reservierungen
            reservations = [];
            roomDetails = [];

            for (let i = 0; i < 10; i++) {
                const start = new Date(startDate);
                start.setDate(start.getDate() + Math.floor(Math.random() * 20));

                const end = new Date(start);
                end.setDate(end.getDate() + Math.floor(Math.random() * 5) + 1);

                reservations.push({
                    id: i,
                    name: `Test Reservation ${i}`,
                    start: start,
                    end: end,
                    capacity: Math.floor(Math.random() * 4) + 1
                });
            }

            renderTimeline();
        }

        // Rendere Timeline (Canvas)
        function renderTimeline() {
            if (timelineRenderer) {
                timelineRenderer.updateData(reservations, roomDetails, rooms);
            } else {
                // Erstelle Container für Test
                let container = document.querySelector('.timeline-container');
                if (!container) {
                    container = document.createElement('div');
                    container.className = 'timeline-container';
                    container.style.cssText = 'width: 100%; height: 400px; margin: 20px 0; border: 1px solid #ddd;';
                    document.querySelector('.test-container').appendChild(container);
                }

                timelineRenderer = new TimelineUnifiedRenderer(container);
                timelineRenderer.updateData(reservations, roomDetails, rooms);
            }
        }

        // Zoom-Funktion
        function changeZoom() {
            console.log('Zoom function called');
        }

        // Disponierte Filter
        function toggleDisposedReservations() {
            console.log('Toggle disposed function called');
        }

        // Datum-Reset
        function resetDates() {
            console.log('Reset dates function called');
        }

        // ===== VARIABLES AND INITIALIZATION =====

        // Prüfe ob bereits durch timeline-unified.js deklariert
        if (typeof reservations === 'undefined') {
            var reservations = [];
        }
        if (typeof roomDetails === 'undefined') {
            var roomDetails = [];
        }
        if (typeof rooms === 'undefined') {
            var rooms = [];
        }

        // timelineRenderer bereits in timeline-unified.js deklariert - keine erneute Deklaration

        // Initialisierung
        document.addEventListener('DOMContentLoaded', () => {
            updateTestStatus('Page loaded - ready for syntax tests', 'success');

            // Automatische Tests beim Laden
            setTimeout(() => {
                testVariableDeclarations();
                setTimeout(() => testFunctionAvailability(), 500);
            }, 100);
        });
    </script>
</body>

</html>