<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Overlay Performance Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .test-button {
            margin: 5px;
            padding: 10px 15px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .fast { background-color: #4CAF50; color: white; }
        .slow { background-color: #f44336; color: white; }
        .immediate { background-color: #ff9800; color: white; }
        .config { background-color: #2196F3; color: white; }
        
        .stats {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
        
        .description {
            color: #666;
            font-size: 14px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Loading Overlay Performance-Test</h1>
    
    <div class="description">
        <p><strong>Performance-Optimierung:</strong> Loading-Indikatoren werden nur nach <span id="current-threshold">800</span>ms angezeigt.</p>
        <p>Schnelle Operationen (&lt; 800ms) zeigen keinen Loading-Indikator, um Performance zu sparen.</p>
    </div>

    <div class="test-section">
        <h3>üöÄ Schnelle Operationen (sollten kein Loading zeigen)</h3>
        <button class="test-button fast" onclick="testFastOperation(100)">100ms Operation</button>
        <button class="test-button fast" onclick="testFastOperation(300)">300ms Operation</button>
        <button class="test-button fast" onclick="testFastOperation(500)">500ms Operation</button>
        <button class="test-button fast" onclick="testFastOperation(700)">700ms Operation</button>
    </div>

    <div class="test-section">
        <h3>üêå Langsame Operationen (sollten Loading zeigen)</h3>
        <button class="test-button slow" onclick="testSlowOperation(1000)">1000ms Operation</button>
        <button class="test-button slow" onclick="testSlowOperation(1500)">1500ms Operation</button>
        <button class="test-button slow" onclick="testSlowOperation(2000)">2000ms Operation</button>
        <button class="test-button slow" onclick="testSlowOperation(3000)">3000ms Operation</button>
    </div>

    <div class="test-section">
        <h3>‚ö° Immediate Loading (immer sofort anzeigen)</h3>
        <button class="test-button immediate" onclick="testImmediateOperation(500)">500ms Immediate</button>
        <button class="test-button immediate" onclick="testImmediateOperation(1000)">1000ms Immediate</button>
    </div>

    <div class="test-section">
        <h3>‚öôÔ∏è Konfiguration</h3>
        <button class="test-button config" onclick="setThreshold(200)">200ms Threshold</button>
        <button class="test-button config" onclick="setThreshold(500)">500ms Threshold</button>
        <button class="test-button config" onclick="setThreshold(800)">800ms Threshold</button>
        <button class="test-button config" onclick="setThreshold(1200)">1200ms Threshold</button>
        <br>
        <button class="test-button config" onclick="showStats()">Performance Stats</button>
        <button class="test-button config" onclick="debugOperations()">Debug Operations</button>
    </div>

    <div class="stats" id="stats-display">
        Klicke auf "Performance Stats" um aktuelle Statistiken zu sehen.
    </div>

    <div class="description">
        <h4>Debug-Shortcuts:</h4>
        <ul>
            <li><kbd>Ctrl+Shift+Escape</kbd> - Emergency Hide (alle Loading-Overlays sofort verstecken)</li>
            <li><kbd>Ctrl+Shift+D</kbd> - Debug-Informationen in Konsole ausgeben</li>
        </ul>
    </div>

    <!-- Loading der JavaScript-Module -->
    <script src="js/loading-overlay.js"></script>
    <script src="js/http-utils.js"></script>
    
    <script>
        // Test-Funktionen f√ºr Performance-Demo
        
        async function testFastOperation(duration) {
            console.log(`[TEST] Starting fast operation: ${duration}ms`);
            const startTime = Date.now();
            
            await LoadingOverlay.wrap(async () => {
                await new Promise(resolve => setTimeout(resolve, duration));
                return `Fast operation completed in ${duration}ms`;
            }, `Schnelle Operation (${duration}ms)...`);
            
            const actualDuration = Date.now() - startTime;
            console.log(`[TEST] Fast operation completed in ${actualDuration}ms`);
            showStats();
        }
        
        async function testSlowOperation(duration) {
            console.log(`[TEST] Starting slow operation: ${duration}ms`);
            const startTime = Date.now();
            
            await LoadingOverlay.wrap(async () => {
                await new Promise(resolve => setTimeout(resolve, duration));
                return `Slow operation completed in ${duration}ms`;
            }, `Langsame Operation (${duration}ms)...`);
            
            const actualDuration = Date.now() - startTime;
            console.log(`[TEST] Slow operation completed in ${actualDuration}ms`);
            showStats();
        }
        
        async function testImmediateOperation(duration) {
            console.log(`[TEST] Starting immediate operation: ${duration}ms`);
            const startTime = Date.now();
            
            await LoadingOverlay.wrap(async () => {
                await new Promise(resolve => setTimeout(resolve, duration));
                return `Immediate operation completed in ${duration}ms`;
            }, `Immediate Operation (${duration}ms)...`, false); // useDelay = false
            
            const actualDuration = Date.now() - startTime;
            console.log(`[TEST] Immediate operation completed in ${actualDuration}ms`);
            showStats();
        }
        
        function setThreshold(threshold) {
            LoadingOverlay.setDelayThreshold(threshold);
            document.getElementById('current-threshold').textContent = threshold;
            console.log(`[CONFIG] Threshold set to ${threshold}ms`);
            showStats();
        }
        
        function showStats() {
            const stats = LoadingOverlay.getPerformanceStats();
            const display = document.getElementById('stats-display');
            
            display.innerHTML = `
                <strong>Performance-Statistiken:</strong><br>
                Aktive Operationen: ${stats.activeOperations}<br>
                Verz√∂gerte Operationen: ${stats.delayedOperations}<br>
                Delay-Threshold: ${stats.delayThreshold}ms<br>
                Overlay sichtbar: ${stats.isVisible ? 'Ja' : 'Nein'}<br>
                Timestamp: ${new Date().toLocaleTimeString()}
            `;
        }
        
        function debugOperations() {
            LoadingOverlay.debugOperations();
        }
        
        // HTTP-Utils konfigurieren
        HttpUtils.configurePerformance(800);
        
        // Initiale Stats anzeigen
        setTimeout(showStats, 100);
        
        console.log('[TEST] Performance test page loaded');
        console.log('[TEST] Try different operations to test the 800ms delay threshold');
    </script>
</body>
</html>
