<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <title>Test JavaScript Gruppierung</title>
</head>

<body>
    <h3>Test JavaScript Gruppierung</h3>
    <div id="results"></div>

    <script>
        /**
         * Konvertiert Eingabe zurück zu Anzeige-Format mit Gruppierung
         */
        function convertInputToDisplay(inputText) {
            if (!inputText) return '';

            // Schritt 1: Normalisierung - Kommas und Doppelpunkte mit optionalen Leerzeichen durch Leerzeichen ersetzen
            let normalized = inputText.replace(/\s*[,:]\s*/g, ' ');
            normalized = normalized.replace(/\s+/g, ' ').trim();

            // Schritt 2: Tokenisierung
            const tokens = normalized.split(' ');

            // Schritt 3: Verknüpfte Muster erweitern (z.B. "2veg" → ["2", "veg"])
            const expandedTokens = [];
            for (const token of tokens) {
                if (/^(\d+)([a-zA-ZäöüÄÖÜß].*)$/.test(token)) {
                    const matches = token.match(/^(\d+)([a-zA-ZäöüÄÖÜß].*)$/);
                    expandedTokens.push(matches[1]); // Zahl
                    expandedTokens.push(matches[2]); // Text
                } else {
                    expandedTokens.push(token);
                }
            }

            // Schritt 4: Parsing in Anzahl-Bemerkung Paare
            const entries = [];
            let i = 0;

            while (i < expandedTokens.length) {
                const token = expandedTokens[i];

                if (/^\d+$/.test(token)) {
                    const anzahl = parseInt(token);
                    let bemerkung = '';

                    // Sammle alle nachfolgenden nicht-numerischen Tokens als Bemerkung
                    const bemerkungParts = [];
                    let j = i + 1;
                    while (j < expandedTokens.length && !/^\d+$/.test(expandedTokens[j])) {
                        bemerkungParts.push(expandedTokens[j]);
                        j++;
                    }

                    if (bemerkungParts.length > 0) {
                        bemerkung = bemerkungParts.join(' ');
                    }

                    if (anzahl > 0) {
                        entries.push({
                            anz: anzahl,
                            bem: bemerkung.trim()
                        });
                    }

                    i = j; // Springe zur nächsten Zahl
                } else {
                    i++; // Überspringe nicht-numerische Tokens
                }
            }

            // Schritt 5: Gruppierung nach gleichen Bemerkungen
            const grouped = {};
            for (const entry of entries) {
                const bemerkung = entry.bem;
                const anzahl = entry.anz;

                if (grouped.hasOwnProperty(bemerkung)) {
                    grouped[bemerkung] += anzahl;
                } else {
                    grouped[bemerkung] = anzahl;
                }
            }

            // Schritt 6: Zurück in Anzeige-Format konvertieren
            const displayParts = [];
            for (const [bemerkung, totalAnzahl] of Object.entries(grouped)) {
                if (bemerkung === '') {
                    displayParts.push(totalAnzahl.toString());
                } else {
                    displayParts.push(totalAnzahl + ' ' + bemerkung);
                }
            }

            return displayParts.join('\n');
        }

        // Tests ausführen
        const testCases = [
            "5 3veg 3 veg 1",
            "5,3veg, 3    veg, 1",
            "5    3 veg,3veg 1"
        ];

        let output = '<h4>JavaScript Gruppierungs-Tests:</h4>';

        testCases.forEach((testCase, index) => {
            const result = convertInputToDisplay(testCase);
            const lines = result.split('\n');

            output += `<p><strong>Test ${index + 1}:</strong> "${testCase}"</p>`;
            output += '<ul>';
            lines.forEach(line => {
                if (line.trim()) {
                    const parts = line.trim().split(' ');
                    const anz = parts[0];
                    const bem = parts.slice(1).join(' ') || '""';
                    output += `<li>${anz} x "${bem}"</li>`;
                }
            });
            output += '</ul><br>';
        });

        document.getElementById('results').innerHTML = output;
    </script>
</body>

</html>